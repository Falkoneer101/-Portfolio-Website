let timeBalance = parseInt(localStorage.getItem('timeBalance')) || 3600;
let timer;
var checkoutAmount;

function addTime() {
    var additionalTime = parseInt(document.getElementById('additionalTime').value);
    var timeUnit = document.getElementById('timeUnit').value;
    
    if (timeUnit === 'minutes') {
        timeBalance += additionalTime * 60;
    } else if (timeUnit === 'hour') {
        timeBalance += additionalTime * 3600;
    }else if (timeUnit === 'hours') {
        timeBalance += additionalTime * 3600;
    }
    localStorage.setItem('timeBalance', timeBalance);

    document.getElementById('timeBalance').innerText = timeBalance;
    updateCheckoutSection();
}

function updateCheckoutSection() {
    var checkoutTime = parseInt(document.getElementById('additionalTime').value);
    var timeUnit = document.getElementById('timeUnit').value;

    if (timeUnit === 'minutes') {
        checkoutAmount = checkoutTime * (5/15);
        document.getElementById('checkoutTime').innerText = ' ' + checkoutTime + ' minutes';
    } else if (timeUnit === 'hour') {  
        checkoutAmount = checkoutTime * 15; 
        document.getElementById('checkoutTime').innerText = ' ' + checkoutTime + ' hour';
    } else if (timeUnit === 'hours') {
        checkoutAmount = checkoutTime * 15;
        document.getElementById('checkoutTime').innerText = ' ' + checkoutTime + ' hours';
    }

    document.getElementById('checkoutAmount').innerText = checkoutAmount;
    document.getElementById('paymentAmount').innerText = 'Amount to pay: ' + checkoutAmount + ' pesos';
    document.getElementById('checkoutSection').style.display = 'block';
}

function subtractFromWallet(total){
    const amount = document.getElementById('walletBalance');

    if("walletBalance" !== null){
        let currentBalance = parseFloat(localStorage.getItem("walletBalance")) || 0;
        const newBalance = currentBalance - total;

        localStorage.setItem("walletBalance", newBalance);        
    }else{
        alert("Invalid input. Please enter a valid amount.");
    }
}

function checkout() {
    updateCheckoutSection();
    subtractFromWallet(checkoutAmount);
    localStorage.setItem('timeBalance', timeBalance);
    alert('Checkout Successful!');
}


function updateTimeBalance() {
    const timeSpan = document.getElementById("timeBalance"); 
    const hours = Math.floor(timeBalance / 3600);
    const minutes = Math.floor((timeBalance % 3600) / 60);
    const seconds = timeBalance % 60;

    if (timeBalance >= 3600) {
        timeSpan.textContent = `${hours} hr(s)`;
    } else if (timeBalance >= 60) {
        timeSpan.textContent = `${minutes} min(s)`;
    } else {
        timeSpan.textContent = `${seconds} sec`;
    }

    timeBalance--;

    if (timeBalance <= 0) {
        clearInterval(timer);
        alert("Time's up!");
    }
    timeSpan.textContent = `${hours} hr(s) ${minutes} min(s) ${seconds} sec`;

}

timer = setInterval(updateTimeBalance, 1000);
document.getElementById('timeBalance').innerText = timeBalance;
